<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FinanÃ§a Animal</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:Arial;
  margin:0;
  background:url('https://images.unsplash.com/photo-1517849845537-4d257902454a') center/cover fixed;
  font-size:18px;
}
header{background:#4e342e;color:white;text-align:center;padding:15px;font-size:22px;}
.container{max-width:900px;margin:auto;padding:15px;}
.box{background:white;border-radius:15px;padding:15px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,0.2);}
input,textarea,button{width:100%;padding:12px;margin-top:8px;border-radius:10px;border:1px solid #ccc;font-size:16px;}
button{background:#6d4c41;color:white;font-weight:bold;border:none;cursor:pointer;}
canvas{max-width:300px;margin:auto;display:block}
.tip-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;}
.tip-card{perspective:1000px;height:100px;}
.tip-inner{position:relative;width:100%;height:100%;transition:transform 0.6s;transform-style:preserve-3d;}
.tip-front,.tip-back{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:10px;display:flex;align-items:center;justify-content:center;text-align:center;padding:5px;}
.tip-front{background:#ffca28;}
.tip-back{background:#6d4c41;color:white;transform:rotateY(180deg);}
.post img,video{width:100%;border-radius:10px;margin-top:5px}
</style>
</head>

<body>
<header>ğŸ¾ FinanÃ§a Animal</header>
<div class="container">

<div class="box">
<h3>ğŸ’° Planejamento do Pet</h3>
<input id="food" type="number" placeholder="AlimentaÃ§Ã£o">
<input id="health" type="number" placeholder="SaÃºde">
<input id="extras" type="number" placeholder="Mimos">
<button onclick="calc()">Analisar Gastos</button>
<p id="alert"></p>
<canvas id="chart"></canvas>
</div>

<div class="box">
<h3>ğŸ’¡ Dicas</h3>
<div class="tip-grid" id="tips"></div>
</div>

<div class="box">
<h3>ğŸ“– HistÃ³ria do seu Pet</h3>
<input id="petName" placeholder="Nome do Pet">
<textarea id="story" placeholder="Conte a histÃ³ria"></textarea>
<input type="file" id="photos">
<button onclick="postStory()">Publicar HistÃ³ria</button>
<div id="stories"></div>
</div>

<div class="box">
<h3>ğŸ“¸ Momento Fofura</h3>
<input type="file" id="cuteUpload">
<button onclick="addCute()">Adicionar Foto</button>
<div id="cute"></div>
</div>

<div class="box">
<h3>ğŸ¥ VÃ­deos EngraÃ§ados</h3>
<input type="file" id="videoUpload" accept="video/*">
<button onclick="addVideo()">Adicionar VÃ­deo</button>
<div id="videos"></div>
</div>

</div>

<script>
let chart;
function calc(){
let f=+food.value||0,h=+health.value||0,e=+extras.value||0,total=f+h+e;
alert.innerText=total>500?"âš  Gastando muito!":"âœ… Gastos sob controle!";
if(chart)chart.destroy();
chart=new Chart(chartCanvas=document.getElementById("chart"),{
type:'doughnut',
data:{labels:["AlimentaÃ§Ã£o","SaÃºde","Mimos"],datasets:[{data:[f,h,e]}]}
});
}

/* DICAS AUTOMÃTICAS */
const tipList=[
"Vacinas evitam gastos grandes",
"RaÃ§Ã£o boa reduz veterinÃ¡rio",
"Escovar dentes evita cirurgia",
"Passeio mantÃ©m saÃºde",
"HidrataÃ§Ã£o Ã© essencial",
"Brincar reduz ansiedade",
"Check-up previne doenÃ§as",
"Amor tambÃ©m Ã© cuidado ğŸ’›"
];
function updateTips(){
tips.innerHTML="";
tipList.sort(()=>0.5-Math.random()).slice(0,4).forEach(t=>{
tips.innerHTML+=`<div class="tip-card"><div class="tip-inner">
<div class="tip-front">ğŸ¶ Dica</div>
<div class="tip-back">${t}</div>
</div></div>`;
});
}
updateTips();
setInterval(updateTips,8000);
</script>

<!-- ğŸ”¥ FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyCtWTnPgwTreMjrthlXxGu0WOPYRE6W",
authDomain:"financa-animal.firebaseapp.com",
projectId:"financa-animal",
storageBucket:"financa-animal.firebasestorage.app",
messagingSenderId:"693788312237",
appId:"1:693788312237:web:169d6407dc2eb3136fc24"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const badWords=["idiota","burro","feio","lixo"];

function filterText(t){
badWords.forEach(w=>t=t.replaceAll(w,"***"));
return t;
}

window.postStory=async()=>{
let name=petName.value,txt=filterText(story.value),file=photos.files[0];
if(!name||!txt||!file)return alert("Preencha tudo");
let r=new FileReader();
r.onload=async e=>{
await addDoc(collection(db,"stories"),{name,txt,img:e.target.result,likes:0,comments:[]});
loadStories();
}
r.readAsDataURL(file);
}

window.likeStory=async(id,likes)=>{await updateDoc(doc(db,"stories",id),{likes:likes+1});loadStories();}

window.deleteStory=async(id)=>{
let s=prompt("Senha admin:");
if(s!=="123petadmin")return alert("SÃ³ admin apaga");
await deleteDoc(doc(db,"stories",id));
loadStories();
}

window.addComment=async(e,id)=>{
e.preventDefault();
let input=e.target.comment;
if(!input.value)return;
let ref=doc(db,"stories",id);
let snap=await getDoc(ref);
let comments=snap.data().comments||[];
comments.push(filterText(input.value));
await updateDoc(ref,{comments});
loadStories();
}

async function loadStories(){
stories.innerHTML="";
const qs=await getDocs(collection(db,"stories"));
qs.forEach(s=>{
let d=s.data();
stories.innerHTML+=`
<div class="post">
<h4>${d.name}</h4>
<p>${d.txt}</p>
<img src="${d.img}">
<button onclick="likeStory('${s.id}',${d.likes})">â¤ï¸ ${d.likes}</button>
<button onclick="deleteStory('${s.id}')">ğŸ—‘ï¸</button>
${d.comments.map(c=>`<p>ğŸ’¬ ${c}</p>`).join("")}
<form onsubmit="addComment(event,'${s.id}')">
<input name="comment" placeholder="Comentar...">
</form>
</div>`;
});
}
loadStories();
</script>
</body>
</html>
