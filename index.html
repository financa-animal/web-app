<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>FofoPet</title>

<!-- Chart + PDF -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:url("https://images.unsplash.com/photo-1517849845537-4d257902454a") center/cover fixed;
}

/* Camada clara sobre o fundo */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:rgba(255,255,255,0.85);
  z-index:-1;
}

header{
  text-align:center;
  padding:15px;
  font-weight:bold;
  font-size:22px;
  color:#444;
}

.container{
  max-width:1000px;
  margin:auto;
  padding:10px;
}

.card{
  background:white;
  padding:15px;
  border-radius:12px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
  margin-bottom:20px;
}

input, textarea{
  width:100%;
  padding:8px;
  margin:5px 0;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  background:#6aa9a1;
  border:none;
  padding:8px 12px;
  border-radius:8px;
  color:white;
  cursor:pointer;
}

/* DICAS GIRANDO */
.tip-box{
  height:60px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  transition:0.5s;
}

/* CHAT LATERAL */
.chat{
  position:fixed;
  right:0;
  top:80px;
  width:320px;
  height:70%;
  background:white;
  box-shadow:-4px 0 10px rgba(0,0,0,0.1);
  border-radius:12px 0 0 12px;
  display:flex;
  flex-direction:column;
}

.chat-header{
  background:#6aa9a1;
  color:white;
  padding:10px;
  display:flex;
  justify-content:space-between;
}

.chat-messages{
  flex:1;
  overflow-y:auto;
  padding:10px;
}

.chat input{
  width:90%;
  margin:5px;
}

.minimized{
  height:40px !important;
}

/* MOBILE */
@media(max-width:768px){
  .chat{ width:100%; top:auto; bottom:0; height:50%; }
}
</style>
</head>

<body>

<header>üêæ FofoPet</header>

<div class="container">

<!-- HIST√ìRIAS -->
<div class="card">
  <h3>Hist√≥ria do seu pet</h3>
  <input id="petNome" placeholder="Nome do pet">
  <textarea id="petHistoria" placeholder="Conte a hist√≥ria"></textarea>
  <button onclick="postarHistoria()">Postar</button>
  <div id="feedHistorias"></div>
</div>

<!-- FINANCEIRO -->
<div class="card">
  <h3>Calculadora de Gastos</h3>
  <input id="racao" type="number" placeholder="Ra√ß√£o">
  <input id="vet" type="number" placeholder="Veterin√°rio">
  <input id="brinq" type="number" placeholder="Brinquedos">
  <button onclick="calcular()">Calcular</button>
  <canvas id="grafico" width="200"></canvas>
  <p id="alerta" style="color:red;font-weight:bold;"></p>
  <button onclick="salvarPDF()">Salvar em PDF</button>
</div>

<!-- DICAS -->
<div class="card">
  <h3>Dicas para seu pet</h3>
  <div class="tip-box" id="tipBox">Carregando...</div>
</div>

</div>

<!-- CHAT -->
<div class="chat" id="chatBox">
  <div class="chat-header">
    Chat Fofo
    <button onclick="toggleChat()">‚Äî</button>
  </div>
  <div class="chat-messages" id="chatMensagens"></div>
  <input id="chatInput" placeholder="Mensagem">
  <button onclick="enviarMsg()">Enviar</button>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî• COLE SUA CONFIG AQUI */
const firebaseConfig = {
  apiKey: "SUA_KEY",
  authDomain: "SEU_DOMINIO",
  projectId: "SEU_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* HIST√ìRIAS */
window.postarHistoria = async () => {
  const nome = petNome.value;
  const historia = petHistoria.value;
  if(!historia) return;
  await addDoc(collection(db,"historias"),{nome,historia});
};

onSnapshot(collection(db,"historias"), snap=>{
  feedHistorias.innerHTML="";
  snap.forEach(doc=>{
    const d = doc.data();
    feedHistorias.innerHTML += `<p><b>${d.nome}</b>: ${d.historia}</p>`;
  });
});

/* CHAT */
window.enviarMsg = async () =>{
  const msg = chatInput.value;
  if(!msg) return;
  await addDoc(collection(db,"chat"),{msg});
  chatInput.value="";
};

onSnapshot(collection(db,"chat"), snap=>{
  chatMensagens.innerHTML="";
  snap.forEach(doc=>{
    chatMensagens.innerHTML += `<div>${doc.data().msg}</div>`;
  });
});
</script>

<script>
/* DICAS ROTATIVAS */
const tips=[
"√Ågua fresca sempre dispon√≠vel üíß",
"Passeios evitam ansiedade üêï",
"Vacinas salvam vidas üíâ",
"Brincar fortalece o v√≠nculo ‚ù§Ô∏è"
];
let i=0;
setInterval(()=>{
  tipBox.innerText=tips[i];
  i=(i+1)%tips.length;
},3000);

/* GR√ÅFICO */
let chart;
function calcular(){
  const r=+racao.value||0;
  const v=+vet.value||0;
  const b=+brinq.value||0;
  const total=r+v+b;

  if(total>500) alerta.innerText="‚ö† Gasto alto esse m√™s!";
  else alerta.innerText="";

  const ctx=document.getElementById("grafico");
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:"doughnut",
    data:{labels:["Ra√ß√£o","Vet","Brinq"],
    datasets:[{data:[r,v,b]}]}
  });
}

/* PDF */
function salvarPDF(){
  const { jsPDF } = window.jspdf;
  const doc=new jsPDF();
  doc.text("Relat√≥rio FofoPet",20,20);
  doc.text("Ra√ß√£o: "+racao.value,20,40);
  doc.text("Vet: "+vet.value,20,50);
  doc.text("Brinquedos: "+brinq.value,20,60);
  doc.save("gastos.pdf");
}

/* CHAT MINIMIZAR */
function toggleChat(){
  chatBox.classList.toggle("minimized");
}
</script>

</body>
</html>
