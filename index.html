<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Finan√ßa Animal</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js"></script>

<style>
body{font-family:Arial;margin:0;background:url('https://images.unsplash.com/photo-1507146426996-ef05306b995a')center/cover fixed;}
header{background:#4e342e;color:white;text-align:center;padding:15px;font-size:22px;}
.container{max-width:900px;margin:auto;padding:15px;}
.box{background:white;border-radius:15px;padding:15px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,0.2);}
input,textarea,button{width:100%;padding:8px;margin-top:6px;border-radius:8px;border:1px solid #ccc;}
button{background:#6d4c41;color:white;font-weight:bold;border:none;cursor:pointer;}
canvas{max-width:300px;margin:auto;display:block}
.post img{width:100%;border-radius:10px;margin-top:5px}
.actions{display:flex;gap:10px;margin-top:5px}
.comment{background:#f1f1f1;margin-top:5px;padding:5px;border-radius:5px}
</style>
</head>

<body>
<header>üêæ Finan√ßa Animal</header>
<div class="container">

<div class="box">
<h3>üìñ Hist√≥ria do seu Pet</h3>
<input id="petName" placeholder="Nome do Pet">
<textarea id="story" placeholder="Conte a hist√≥ria"></textarea>
<input type="file" id="photos" multiple>
<button onclick="postStory()">Publicar Hist√≥ria</button>
<div id="stories"></div>
</div>

</div>

<script type="module">
// üî• CONFIG FIREBASE
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "SUA_CHAVE",
  authDomain: "SEU_DOMINIO",
  projectId: "SEU_ID",
  storageBucket: "SEU_BUCKET",
  messagingSenderId: "SEU_ID",
  appId: "SEU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

// POSTAR HIST√ìRIA
async function postStory(){
let name=petName.value, txt=story.value, files=photos.files;
if(!name||!txt||files.length===0) return alert("Preencha tudo");

let urls=[];
for(let file of files){
let storageRef=ref(storage,"pets/"+Date.now()+file.name);
await uploadBytes(storageRef,file);
let url=await getDownloadURL(storageRef);
urls.push(url);
}

await addDoc(collection(db,"stories"),{
name, txt, images:urls, likes:0, comments:[]
});

loadStories();
}

// CARREGAR HIST√ìRIAS
async function loadStories(){
stories.innerHTML="";
const querySnapshot = await getDocs(collection(db,"stories"));
querySnapshot.forEach((docSnap)=>{
let s=docSnap.data();
let id=docSnap.id;

let div=document.createElement("div");
div.className="post";
div.innerHTML=`<h4>${s.name}</h4>
<p contenteditable="true" onblur="saveEdit('${id}', this.innerText)">${s.txt}</p>
${s.images.map(img=>`<img src="${img}">`).join("")}
<div class="actions">
<button onclick="likeStory('${id}',${s.likes})">‚ù§Ô∏è ${s.likes}</button>
<button onclick="deleteStory('${id}')">üóë Excluir</button>
</div>
<input placeholder="Comentar" onkeypress="commentStory(event,'${id}', ${JSON.stringify(s.comments)})">`;

stories.appendChild(div);
});
}

window.likeStory = async (id,likes)=>{
await updateDoc(doc(db,"stories",id),{likes:likes+1});
loadStories();
}

window.deleteStory = async (id)=>{
await deleteDoc(doc(db,"stories",id));
loadStories();
}

window.saveEdit = async (id,text)=>{
await updateDoc(doc(db,"stories",id),{txt:text});
}

window.commentStory = async (e,id,comments)=>{
if(e.key==="Enter"){
comments.push(e.target.value);
await updateDoc(doc(db,"stories",id),{comments});
loadStories();
}
}

loadStories();
</script>
</body>
</html>
