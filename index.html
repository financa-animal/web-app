<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FofoPet üêæ</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
 margin:0;
 font-family:Poppins;
 background:#f4f7f6 url("https://i.imgur.com/8Km9tLL.png") no-repeat bottom right fixed;
 background-size:220px;
 color:#333;
}

header{
 background:linear-gradient(90deg,#6a9c89,#a7c4bc);
 padding:15px;
 text-align:center;
 font-size:22px;
 font-weight:700;
 color:white;
}

.container{max-width:750px;margin:auto;padding:15px}

.card{
 background:white;
 border-radius:16px;
 padding:12px;
 margin-bottom:15px;
 box-shadow:0 4px 10px rgba(0,0,0,0.08)
}

textarea,input{
 width:100%;
 padding:8px;
 margin-top:6px;
 border-radius:8px;
 border:1px solid #ddd
}

button{
 background:#6a9c89;
 border:none;
 padding:8px 14px;
 border-radius:20px;
 color:white;
 margin-top:8px;
 cursor:pointer
}

.post-img{width:100%;border-radius:12px;margin-top:8px}
.like{color:#6a9c89;font-weight:bold;cursor:pointer}

.small{font-size:12px;color:#666}

/* CHAT LATERAL */
.chat-fixed{
 position:fixed;
 right:10px;
 bottom:10px;
 width:280px;
 background:white;
 border-radius:16px;
 box-shadow:0 4px 12px rgba(0,0,0,0.2);
 padding:10px
}
.chat-box{height:200px;overflow-y:auto}

/* DICAS */
.tip-card{
 background:#e8f1f2;
 padding:15px;
 border-radius:16px;
 text-align:center;
 font-weight:500;
 margin-bottom:10px;
}

@media(max-width:900px){
 .chat-fixed{position:static;width:100%;margin-bottom:15px}
}
</style>
</head>

<body>
<header>üêæ FofoPet</header>

<div class="container">

<!-- HIST√ìRIA -->
<div class="card">
<h3>Hist√≥ria do seu pet</h3>
<input id="name" placeholder="Nome do pet">
<textarea id="story" placeholder="Conte a hist√≥ria"></textarea>
<input id="image" placeholder="Link da foto">
<button onclick="addPost()">Postar</button>
</div>

<div id="posts"></div>

<!-- CALCULADORA -->
<div class="card">
<h3>Calculadora de Gastos</h3>
<input id="food" placeholder="Ra√ß√£o">
<input id="vet" placeholder="Veterin√°rio">
<input id="toy" placeholder="Brinquedos">
<button onclick="calc()">Calcular</button>
<canvas id="grafico"></canvas>
<button onclick="gerarPDF()">Salvar em PDF</button>
</div>

<!-- DICAS -->
<div class="card">
<h3>Dicas para seu pet</h3>
<div id="tips"></div>
</div>

</div>

<!-- CHAT FIXO -->
<div class="chat-fixed">
<h4>Chat üí¨</h4>
<div class="chat-box" id="chat"></div>
<input id="msg" placeholder="Digite..." onkeypress="if(event.key==='Enter')sendMsg()">
<button onclick="sendMsg()">Enviar</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, updateDoc, doc, arrayUnion, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyCtwYxRgTmrTyjqHGX6P0VPYER",
 authDomain:"financa-animal.firebaseapp.com",
 projectId:"financa-animal"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const banned=["sexo","porn","morte","matar","violencia","idiota","burro"];

window.addPost=async()=>{
 const n=name.value,s=story.value,i=image.value;
 if(banned.some(w=>s.toLowerCase().includes(w)))return alert("Texto bloqueado");
 await addDoc(collection(db,"posts"),{n,s,i,likes:0,comments:[]});
}

onSnapshot(collection(db,"posts"),snap=>{
 posts.innerHTML="";
 snap.forEach(d=>{
  const p=d.data();
  posts.innerHTML+=`<div class="card"><b>${p.n}</b><p>${p.s}</p>
  ${p.i?`<img src="${p.i}" class="post-img">`:""}
  <div class="like" onclick="likePost('${d.id}')">‚ù§Ô∏è ${p.likes}</div>
  <input placeholder="Comentar" onkeypress="if(event.key==='Enter')comment('${d.id}',this.value)">
  ${p.comments.map(c=>`<div class="small">üí¨ ${c}</div>`).join("")}</div>`;
 })
})

window.likePost=async(id)=>{
 const r=doc(db,"posts",id);
 const s=await getDoc(r);
 await updateDoc(r,{likes:s.data().likes+1});
}

window.comment=async(id,t)=>{
 if(banned.some(w=>t.toLowerCase().includes(w)))return alert("Coment√°rio bloqueado");
 await updateDoc(doc(db,"posts",id),{comments:arrayUnion(t)});
}

window.sendMsg=async()=>{
 const text=msg.value;
 if(banned.some(w=>text.toLowerCase().includes(w)))return;
 await addDoc(collection(db,"chat"),{text});
 msg.value="";
}

onSnapshot(collection(db,"chat"),s=>{
 chat.innerHTML="";
 s.forEach(d=>chat.innerHTML+=`<div>üí¨ ${d.data().text}</div>`);
})

// GR√ÅFICO REDONDO
window.calc=()=>{
 let f=+food.value,v=+vet.value,t=+toy.value;
 let total=f+v+t;
 new Chart(grafico,{type:'pie',data:{labels:['Ra√ß√£o','Vet','Brinq'],datasets:[{data:[f,v,t]}]}});
 if(total>500)alert("‚ö†Ô∏è Seus gastos est√£o altos este m√™s!");
}

// PDF
window.gerarPDF=()=>{
 const {jsPDF}=window.jspdf;
 const doc=new jsPDF();
 doc.text("Relat√≥rio de Gastos do Pet",10,10);
 doc.save("gastos.pdf");
}

// DICAS ROTATIVAS
const dicas=[
"√Ågua fresca sempre dispon√≠vel ü•§",
"Passeios evitam ansiedade üêï",
"Vacinas em dia salvam vidas üíâ",
"Brincar fortalece o v√≠nculo ‚ù§Ô∏è"
];

function loadTips(){
 tips.innerHTML="";
 dicas.forEach(d=>tips.innerHTML+=`<div class="tip-card">${d}</div>`);
}
loadTips();
setInterval(loadTips,6000);
</script>
</body>
</html>
